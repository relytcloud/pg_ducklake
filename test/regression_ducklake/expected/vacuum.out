-- Test VACUUM on DuckLake tables
CREATE TABLE vacuum_test (a int, b text) USING ducklake;
INSERT INTO vacuum_test VALUES (1, 'one'), (2, 'two'), (3, 'three');
SELECT * FROM vacuum_test ORDER BY a;
 a |   b   
---+-------
 1 | one
 2 | two
 3 | three
(3 rows)

DELETE FROM vacuum_test WHERE a = 2;
SELECT * FROM vacuum_test ORDER BY a;
 a |   b   
---+-------
 1 | one
 3 | three
(2 rows)

-- Should trigger ducklake_rewrite_data_files and others
VACUUM vacuum_test;
-- Should trigger ducklake_cleanup_old_files explicitly (though we do it in standard vacuum too now)
-- VACUUM FULL vacuum_test;
SELECT * FROM vacuum_test ORDER BY a;
 a |   b   
---+-------
 1 | one
 3 | three
(2 rows)

DROP TABLE vacuum_test;
