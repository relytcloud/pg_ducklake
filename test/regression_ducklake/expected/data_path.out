-- Create ducklake relative to PG data directory.
SELECT ducklake.create_metadata();
NOTICE:  No data path provided, using default: DataDir/pg_ducklake
NOTICE:  schema "ducklake" already exists, skipping
 create_metadata 
-----------------
 
(1 row)

SELECT
    starts_with(data_path, data_directory) as is_prefix,
    replace(data_path, data_directory, '') as relative_data_path
FROM
(SELECT value AS data_path FROM ducklake.ducklake_metadata WHERE key = 'data_path'),
(SELECT setting AS data_directory FROM pg_settings WHERE name = 'data_directory');
 is_prefix | relative_data_path 
-----------+--------------------
 t         | /pg_ducklake/
(1 row)

SELECT path, path_is_relative FROM ducklake.ducklake_schema WHERE schema_id = 0;
 path  | path_is_relative 
-------+------------------
 main/ | t
(1 row)

SELECT ducklake.drop_metadata(true);
WARNING:  Deleting all ducklake files
 drop_metadata 
---------------
 
(1 row)

-- Create ducklake at S3.
SELECT ducklake.create_metadata('s3://ducklake-bucket/');
NOTICE:  schema "ducklake" already exists, skipping
 create_metadata 
-----------------
 
(1 row)

SELECT
    starts_with(data_path, data_directory) as is_prefix,
    replace(data_path, data_directory, '') as relative_data_path
FROM
(SELECT value AS data_path FROM ducklake.ducklake_metadata WHERE key = 'data_path'),
(SELECT setting AS data_directory FROM pg_settings WHERE name = 'data_directory');
 is_prefix |  relative_data_path   
-----------+-----------------------
 f         | s3://ducklake-bucket/
(1 row)

SELECT path, path_is_relative FROM ducklake.ducklake_schema WHERE schema_id = 0;
 path  | path_is_relative 
-------+------------------
 main/ | t
(1 row)

SELECT ducklake.drop_metadata(true);
WARNING:  Deleting all ducklake files
 drop_metadata 
---------------
 
(1 row)

-- Create ducklake at local directory.
SELECT ducklake.create_metadata('/tmp/ducklake/');
NOTICE:  schema "ducklake" already exists, skipping
 create_metadata 
-----------------
 
(1 row)

SELECT
    starts_with(data_path, data_directory) as is_prefix,
    replace(data_path, data_directory, '') as relative_data_path
FROM
(SELECT value AS data_path FROM ducklake.ducklake_metadata WHERE key = 'data_path'),
(SELECT setting AS data_directory FROM pg_settings WHERE name = 'data_directory');
 is_prefix | relative_data_path 
-----------+--------------------
 f         | /tmp/ducklake/
(1 row)

SELECT path, path_is_relative FROM ducklake.ducklake_schema WHERE schema_id = 0;
 path  | path_is_relative 
-------+------------------
 main/ | t
(1 row)

SELECT ducklake.drop_metadata(true);
WARNING:  Deleting all ducklake files
 drop_metadata 
---------------
 
(1 row)

