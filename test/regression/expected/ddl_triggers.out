-- Test DDL event triggers
-- Verify event triggers were created
SELECT evtname FROM pg_event_trigger WHERE evtname LIKE 'ducklake%' ORDER BY evtname;
            evtname
---------------------------------
 ducklake_create_table_trigger
 ducklake_drop_trigger
(2 rows)

-- Create a simple ducklake table
CREATE TABLE products (
    product_id int NOT NULL,
    product_name text NOT NULL,
    price numeric(10,2)
) USING ducklake;
-- Verify table was created in PostgreSQL
SELECT relname, am.amname
FROM pg_class c
JOIN pg_am am ON c.relam = am.oid
WHERE c.relname = 'products';
 relname  |  amname
----------+----------
 products | ducklake
(1 row)

-- Insert some data
INSERT INTO products VALUES (1, 'Widget', 19.99);
INSERT INTO products VALUES (2, 'Gadget', 29.99);
-- Query the data
SELECT * FROM products ORDER BY product_id;
 product_id | product_name | price
------------+--------------+-------
          1 | Widget       | 19.99
          2 | Gadget       | 29.99
(2 rows)

-- Create another table with different types
CREATE TABLE orders (
    order_id int NOT NULL,
    order_date timestamp,
    customer_name varchar(100),
    total_amount numeric(12,2)
) USING ducklake;
-- Verify second table
SELECT relname FROM pg_class WHERE relname = 'orders' AND relam = (SELECT oid FROM pg_am WHERE amname = 'ducklake');
 relname
---------
 orders
(1 row)

-- Drop first table
DROP TABLE products;
-- Verify it's gone from PostgreSQL
SELECT relname FROM pg_class WHERE relname = 'products';
 relname
---------
(0 rows)

-- Clean up
DROP TABLE orders;
